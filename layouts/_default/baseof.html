<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
{{ partial "head.html" . }}
<body>
  <nav class="mobile-nav">
    <a href="/" class="mobile-home">erg0nix</a>
    <a href="/projects">~/projects</a>
    <a href="/blog">~/blog</a>
    <a href="/feed">~/feed</a>
    <a href="/bookmarks">~/bookmarks</a>
  </nav>

  <div class="layout">
    <aside class="sidebar">
      <div class="profile">
        <div class="profile-text">
          <h1><a href="/">{{ .Site.Title }}</a></h1>
          <div class="status">
            <span class="status-indicator">‚óè</span> online
          </div>
        </div>
        <img src="/avatar.png" alt="avatar" class="avatar">
      </div>
      
      <nav class="nav">
        <a href="/projects">~/projects</a>
        <a href="/blog">~/blog</a>
        <a href="/feed">~/feed</a>
        <a href="/bookmarks">~/bookmarks</a>
      </nav>
      
      <div class="info">
        <h3>system info</h3>
        <p>location: earth norway</p>
        <p>shell: zsh but fish seem nice</p>
        <p>editor: neovim</p>
        <p>core: melted</p>
        <p>uptime: {{ now.Format "2006" }} - present</p>
      </div>
    </aside>
    
    <main class="content">
      {{ block "main" . }}{{ end }}
      
      <div class="mobile-info">
        <h3>system info</h3>
        <p>location: earth norway</p>
        <p>shell: zsh but fish seem nice</p>
        <p>editor: neovim</p>
        <p>core: melted</p>
        <p>uptime: {{ now.Format "2006" }} - present</p>
      </div>
    </main>
  </div>
  
  <!-- Falling leaves layer for autumn -->
  <div class="leaves-layer" aria-hidden="true"></div>
  
  <!-- Falling snowflakes layer for winter -->
  <div class="snowflakes-layer" aria-hidden="true"></div>

  <script>
    // Falling leaves for autumn
    (function () {
      const EMOJIS = ["üçÇ","üçÅ","üçÉ"];
      let layer = null;
      let intervalId = null;

      function rand(min, max) { return Math.random() * (max - min) + min; }
      function pick(arr) { return arr[(Math.random() * arr.length) | 0]; }

      function makeLeaf() {
        if (!layer) return;
        const MAX_ONSCREEN = 16;
        if (layer.childElementCount > MAX_ONSCREEN) return;

        const el = document.createElement("span");
        el.className = "leaf";
        el.textContent = pick(EMOJIS);

        const size = rand(14, 28);
        const xStart = rand(0, 100);
        const amp = rand(12, 36);
        const drift = rand(-80, 120);
        const fall = rand(9, 16);
        const delay = rand(0, 4);
        const opacity = rand(0.6, 1);

        el.style.setProperty("--size", `${size}px`);
        el.style.setProperty("--xStart", `${xStart}vw`);
        el.style.setProperty("--amp", `${amp}px`);
        el.style.setProperty("--drift", `${drift}px`);
        el.style.setProperty("--fall", `${fall}s`);
        el.style.setProperty("--delay", `${delay}s`);
        el.style.setProperty("--opacity", opacity.toFixed(2));
        el.style.left = `calc(${xStart}vw - ${size/2}px)`;

        el.addEventListener("animationend", () => el.remove(), { once: true });
        layer.appendChild(el);
      }

      function startLeaves() {
        layer = document.querySelector(".leaves-layer");
        if (!layer) return;
        if (intervalId) return;
        intervalId = setInterval(() => {
          if (Math.random() < 0.7) makeLeaf();
        }, 600);
      }

      function stopLeaves() {
        if (intervalId) clearInterval(intervalId);
        intervalId = null;
        if (layer) layer.innerHTML = "";
      }

      function checkLeaves() {
        const html = document.documentElement;
        if (html.classList.contains("weather-rain")) {
          startLeaves();
        } else {
          stopLeaves();
        }
      }

      // Watch for season changes
      const obs = new MutationObserver(checkLeaves);
      obs.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
      checkLeaves(); // Initial check

      window.startLeaves = startLeaves;
      window.stopLeaves = stopLeaves;
    })();

    // Falling snowflakes for winter
    (function () {
      const EMOJIS = ["‚ùÑÔ∏è","‚ùÖ","‚ùÜ"];
      let layer = null;
      let intervalId = null;

      function rand(min, max) { return Math.random() * (max - min) + min; }
      function pick(arr) { return arr[(Math.random() * arr.length) | 0]; }

      function makeSnowflake() {
        if (!layer) return;
        const MAX_ONSCREEN = 12;
        if (layer.childElementCount > MAX_ONSCREEN) return;

        const el = document.createElement("span");
        el.className = "snowflake";
        el.textContent = pick(EMOJIS);

        const size = rand(16, 32);
        const xStart = rand(0, 100);
        const amp = rand(8, 25);
        const drift = rand(-60, 100);
        const fall = rand(12, 20);
        const delay = rand(0, 5);
        const opacity = rand(0.5, 0.9);

        el.style.setProperty("--size", `${size}px`);
        el.style.setProperty("--xStart", `${xStart}vw`);
        el.style.setProperty("--amp", `${amp}px`);
        el.style.setProperty("--drift", `${drift}px`);
        el.style.setProperty("--fall", `${fall}s`);
        el.style.setProperty("--delay", `${delay}s`);
        el.style.setProperty("--opacity", opacity.toFixed(2));
        el.style.left = `calc(${xStart}vw - ${size/2}px)`;

        el.addEventListener("animationend", () => el.remove(), { once: true });
        layer.appendChild(el);
      }

      function startSnowflakes() {
        layer = document.querySelector(".snowflakes-layer");
        if (!layer) return;
        if (intervalId) return;
        intervalId = setInterval(() => {
          if (Math.random() < 0.6) makeSnowflake();
        }, 800);
      }

      function stopSnowflakes() {
        if (intervalId) clearInterval(intervalId);
        intervalId = null;
        if (layer) layer.innerHTML = "";
      }

      function checkSnowflakes() {
        const html = document.documentElement;
        if (html.classList.contains("weather-snow")) {
          startSnowflakes();
        } else {
          stopSnowflakes();
        }
      }

      // Watch for season changes
      const obs = new MutationObserver(checkSnowflakes);
      obs.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
      checkSnowflakes(); // Initial check

      window.startSnowflakes = startSnowflakes;
      window.stopSnowflakes = stopSnowflakes;
    })();
  </script>
</body>
</html>