<!-- Autumn rain and falling leaves effects -->
<style>
  /* Rain effect (autumn) - GPU-optimized transform-based */
  html.weather-rain body::before,
  html.weather-rain body::after {
    content: "";
    position: fixed;
    inset: -50dvh 0 0 0;
    height: 200dvh;
    width: 100%;
    pointer-events: none;
    z-index: -2;
    background-repeat: repeat;
    will-change: transform;
    contain: paint;
    backface-visibility: hidden;
    transform: translate3d(0,0,0);
  }
  
  /* fine rain - fast layer */
  html.weather-rain body::before {
    opacity: 0.25;
    background-image:
      radial-gradient(1px 8px at 23px 17px, #7dd3fc, transparent),
      radial-gradient(1px 6px at 142px 8px, #38bdf8, transparent),
      radial-gradient(1px 9px at 251px 19px, #0ea5e9, transparent),
      radial-gradient(1px 7px at 334px 12px, #7dd3fc, transparent),
      radial-gradient(1px 10px at 45px 23px, #38bdf8, transparent),
      radial-gradient(1px 8px at 167px 29px, #0ea5e9, transparent);
    background-size: 400px 60px, 400px 60px, 400px 60px, 400px 60px, 400px 80px, 400px 80px;
    animation: rainMoveA 6s linear infinite;
  }
  
  /* depth rain - slow layer */
  html.weather-rain body::after {
    opacity: 0.15;
    background-image:
      radial-gradient(1px 9px at 56px 27px, #7dd3fc, transparent),
      radial-gradient(1px 7px at 187px 39px, #38bdf8, transparent),
      radial-gradient(1px 8px at 323px 8px, #0ea5e9, transparent),
      radial-gradient(1px 10px at 112px 45px, #7dd3fc, transparent),
      radial-gradient(1px 11px at 78px 16px, #38bdf8, transparent);
    background-size: 400px 70px, 400px 70px, 400px 70px, 400px 70px, 400px 100px;
    animation: rainMoveB 9s linear infinite;
  }

  @keyframes rainMoveA {
    from { transform: translate3d(0,-50dvh,0); }
    to   { transform: translate3d(0,0,0); }
  }
  
  @keyframes rainMoveB {
    from { transform: translate3d(0,-50dvh,0); }
    to   { transform: translate3d(0,0,0); }
  }

  /* Falling leaves for autumn */
  .leaves-layer {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    contain: layout style paint;
  }

  .leaf {
    position: absolute;
    top: -10dvh;
    will-change: transform;
    transform: translate3d(0, -10dvh, 0);
    filter: drop-shadow(0 2px 1px rgba(0,0,0,.25));
    font-size: var(--size, 20px);
    animation: leaf-fall var(--fall, 12s) linear var(--delay, 0s) 1 both;
    opacity: var(--opacity, .9);
  }

  @keyframes leaf-fall {
    0%   { transform: translate3d(var(--xStart, 0vw), -10dvh, 0) rotate(0deg); }
    25%  { transform: translate3d(calc(var(--xStart, 0vw) + var(--amp, 20px)), 25dvh, 0) rotate(90deg); }
    50%  { transform: translate3d(calc(var(--xStart, 0vw) - var(--amp, 20px)), 50dvh, 0) rotate(180deg); }
    75%  { transform: translate3d(calc(var(--xStart, 0vw) + var(--amp, 20px)), 75dvh, 0) rotate(270deg); }
    100% { transform: translate3d(calc(var(--xStart, 0vw) + var(--drift, 0px)), 110dvh, 0) rotate(360deg); }
  }

  @media (prefers-reduced-motion: reduce) {
    .leaves-layer, .leaf { animation: none !important; display: none !important; }
  }
</style>

<!-- Falling leaves layer for autumn -->
<div class="leaves-layer" aria-hidden="true"></div>

<script>
  // Falling leaves for autumn
  (function () {
    const EMOJIS = ["ðŸ‚","ðŸ","ðŸƒ"];
    let layer = null;
    let intervalId = null;

    function rand(min, max) { return Math.random() * (max - min) + min; }
    function pick(arr) { return arr[(Math.random() * arr.length) | 0]; }

    function makeLeaf() {
      if (!layer) return;
      const MAX_ONSCREEN = 16;
      if (layer.childElementCount > MAX_ONSCREEN) return;

      const el = document.createElement("span");
      el.className = "leaf";
      el.textContent = pick(EMOJIS);

      const size = rand(14, 28);
      const xStart = rand(0, 100);
      const amp = rand(12, 36);
      const drift = rand(-80, 120);
      const fall = rand(9, 16);
      const delay = rand(0, 4);
      const opacity = rand(0.6, 1);

      el.style.setProperty("--size", `${size}px`);
      el.style.setProperty("--xStart", `${xStart}vw`);
      el.style.setProperty("--amp", `${amp}px`);
      el.style.setProperty("--drift", `${drift}px`);
      el.style.setProperty("--fall", `${fall}s`);
      el.style.setProperty("--delay", `${delay}s`);
      el.style.setProperty("--opacity", opacity.toFixed(2));
      el.style.left = `calc(${xStart}vw - ${size/2}px)`;

      el.addEventListener("animationend", () => el.remove(), { once: true });
      layer.appendChild(el);
    }

    function startLeaves() {
      layer = document.querySelector(".leaves-layer");
      if (!layer) return;
      if (intervalId) return;
      intervalId = setInterval(() => {
        if (Math.random() < 0.7) makeLeaf();
      }, 600);
    }

    function stopLeaves() {
      if (intervalId) clearInterval(intervalId);
      intervalId = null;
      if (layer) layer.innerHTML = "";
    }

    function checkLeaves() {
      const html = document.documentElement;
      if (html.classList.contains("weather-rain")) {
        startLeaves();
      } else {
        stopLeaves();
      }
    }

    // Watch for season changes
    const obs = new MutationObserver(checkLeaves);
    obs.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
    checkLeaves(); // Initial check

    window.startLeaves = startLeaves;
    window.stopLeaves = stopLeaves;
  })();
</script>

