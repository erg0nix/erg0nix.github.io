<!-- Winter snow effects -->
<style>
  /* Snow effect (winter) - GPU-optimized transform-based */
  html.weather-snow body::before,
  html.weather-snow body::after {
    content: "";
    position: fixed;
    inset: -50dvh 0 0 0;
    height: 200dvh;
    width: 100%;
    pointer-events: none;
    z-index: -2;
    background-repeat: repeat;
    will-change: transform;
    contain: paint;
    backface-visibility: hidden;
    transform: translate3d(0,0,0);
  }
  
  /* mixed size flakes - fast layer */
  html.weather-snow body::before {
    opacity: 0.25;
    background-image:
      radial-gradient(1px 1px at 45px 12px, #ffffff, transparent),
      radial-gradient(2px 2px at 25px 15px, #ffffff, transparent),
      radial-gradient(1px 1px at 185px 38px, #f0f8ff, transparent),
      radial-gradient(3px 3px at 120px 35px, #f0f8ff, transparent),
      radial-gradient(1px 1px at 275px 22px, #e6f3ff, transparent),
      radial-gradient(2px 2px at 215px 8px, #e6f3ff, transparent);
    background-size: 320px 50px, 350px 70px, 320px 50px, 350px 70px, 320px 50px, 350px 70px;
    animation: snowDriftA 8s linear infinite;
  }
  
  /* larger flakes - slow layer */
  html.weather-snow body::after {
    opacity: 0.15;
    background-image:
      radial-gradient(4px 4px at 60px 20px, #f8f8ff, transparent),
      radial-gradient(5px 5px at 35px 30px, #ffffff, transparent),
      radial-gradient(4px 4px at 180px 22px, #e6f3ff, transparent),
      radial-gradient(3px 3px at 310px 28px, #ffffff, transparent);
    background-size: 350px 90px, 350px 90px, 350px 90px, 350px 70px;
    animation: snowDriftB 18s linear infinite;
  }

  @keyframes snowDriftA {
    from { transform: translate3d(0,-50dvh,0); }
    to   { transform: translate3d(0,0,0); }
  }
  
  @keyframes snowDriftB {
    from { transform: translate3d(0,-50dvh,0); }
    to   { transform: translate3d(0,0,0); }
  }

  /* Falling snowflake emojis for winter */
  .snowflakes-layer {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 5;
    contain: layout style paint;
  }

  .snowflake {
    position: absolute;
    top: -10dvh;
    will-change: transform;
    transform: translate3d(0, -10dvh, 0);
    filter: drop-shadow(0 2px 1px rgba(0,0,0,.15));
    font-size: var(--size, 20px);
    animation: snowflake-fall var(--fall, 15s) linear var(--delay, 0s) 1 both;
    opacity: var(--opacity, .8);
  }

  @keyframes snowflake-fall {
    0%   { transform: translate3d(var(--xStart, 0vw), -10dvh, 0) rotate(0deg); }
    25%  { transform: translate3d(calc(var(--xStart, 0vw) + var(--amp, 15px)), 25dvh, 0) rotate(90deg); }
    50%  { transform: translate3d(calc(var(--xStart, 0vw) - var(--amp, 15px)), 50dvh, 0) rotate(180deg); }
    75%  { transform: translate3d(calc(var(--xStart, 0vw) + var(--amp, 15px)), 75dvh, 0) rotate(270deg); }
    100% { transform: translate3d(calc(var(--xStart, 0vw) + var(--drift, 0px)), 110dvh, 0) rotate(360deg); }
  }

  @media (prefers-reduced-motion: reduce) {
    .snowflakes-layer, .snowflake { animation: none !important; display: none !important; }
  }
</style>

<!-- Falling snowflakes layer for winter -->
<div class="snowflakes-layer" aria-hidden="true"></div>

<script>
  // Falling snowflakes for winter
  (function () {
    const EMOJIS = ["❄️","❅","❆"];
    let layer = null;
    let intervalId = null;

    function rand(min, max) { return Math.random() * (max - min) + min; }
    function pick(arr) { return arr[(Math.random() * arr.length) | 0]; }

    function makeSnowflake() {
      if (!layer) return;
      const MAX_ONSCREEN = 12;
      if (layer.childElementCount > MAX_ONSCREEN) return;

      const el = document.createElement("span");
      el.className = "snowflake";
      el.textContent = pick(EMOJIS);

      const size = rand(16, 32);
      const xStart = rand(0, 100);
      const amp = rand(8, 25);
      const drift = rand(-60, 100);
      const fall = rand(12, 20);
      const delay = rand(0, 5);
      const opacity = rand(0.5, 0.9);

      el.style.setProperty("--size", `${size}px`);
      el.style.setProperty("--xStart", `${xStart}vw`);
      el.style.setProperty("--amp", `${amp}px`);
      el.style.setProperty("--drift", `${drift}px`);
      el.style.setProperty("--fall", `${fall}s`);
      el.style.setProperty("--delay", `${delay}s`);
      el.style.setProperty("--opacity", opacity.toFixed(2));
      el.style.left = `calc(${xStart}vw - ${size/2}px)`;

      el.addEventListener("animationend", () => el.remove(), { once: true });
      layer.appendChild(el);
    }

    function startSnowflakes() {
      layer = document.querySelector(".snowflakes-layer");
      if (!layer) return;
      if (intervalId) return;
      intervalId = setInterval(() => {
        if (Math.random() < 0.6) makeSnowflake();
      }, 800);
    }

    function stopSnowflakes() {
      if (intervalId) clearInterval(intervalId);
      intervalId = null;
      if (layer) layer.innerHTML = "";
    }

    function checkSnowflakes() {
      const html = document.documentElement;
      if (html.classList.contains("weather-snow")) {
        startSnowflakes();
      } else {
        stopSnowflakes();
      }
    }

    // Watch for season changes
    const obs = new MutationObserver(checkSnowflakes);
    obs.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
    checkSnowflakes(); // Initial check

    window.startSnowflakes = startSnowflakes;
    window.stopSnowflakes = stopSnowflakes;
  })();
</script>