<!-- Winter snow effects -->
<style>
  /* Realistic snow effect (winter) with depth layers */
  html.weather-snow .snow {
    position: fixed;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    pointer-events: none;
  }

  html.weather-snow .snow.layer-1 {
    z-index: -2;
    opacity: 0.8;
  }

  html.weather-snow .snow.layer-2 {
    z-index: -3;
    opacity: 0.5;
    filter: blur(1px);
  }

  html.weather-snow .snow.layer-3 {
    z-index: -4;
    opacity: 0.3;
    filter: blur(2px);
  }

  .snowflake-drop {
    position: absolute;
    top: -10%;
    pointer-events: none;
    animation: snowfall linear infinite;
  }

  @keyframes snowfall {
    0% {
      transform: translateY(0) translateX(0);
      opacity: 1;
    }
    100% {
      transform: translateY(110vh) translateX(var(--drift, 0px));
      opacity: 0.8;
    }
  }

  .snowflake-particle {
    width: var(--size, 4px);
    height: var(--size, 4px);
    background: radial-gradient(circle, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.9) 40%, rgba(240, 248, 255, 0.6) 100%);
    border-radius: 50%;
    box-shadow:
      0 0 2px rgba(255, 255, 255, 0.8),
      0 0 4px rgba(255, 255, 255, 0.5),
      0 0 6px rgba(230, 243, 255, 0.3);
    animation: snowflake-sway var(--sway-duration, 3s) ease-in-out infinite;
    animation-delay: var(--sway-delay, 0s);
  }

  @keyframes snowflake-sway {
    0%, 100% {
      transform: translateX(0) rotate(0deg);
    }
    25% {
      transform: translateX(var(--sway-amount, 15px)) rotate(90deg);
    }
    50% {
      transform: translateX(0) rotate(180deg);
    }
    75% {
      transform: translateX(calc(var(--sway-amount, 15px) * -1)) rotate(270deg);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .snow, .snowflake-drop { animation: none !important; display: none !important; }
  }

  /* Falling snowflake emojis for winter */
  .snowflakes-layer {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 5;
    contain: layout style paint;
  }

  .snowflake {
    position: absolute;
    top: -10dvh;
    will-change: transform;
    transform: translate3d(0, -10dvh, 0);
    filter: drop-shadow(0 2px 1px rgba(0,0,0,.15));
    font-size: var(--size, 20px);
    animation: snowflake-fall var(--fall, 15s) linear var(--delay, 0s) 1 both;
    opacity: var(--opacity, .8);
  }

  @keyframes snowflake-fall {
    0%   { transform: translate3d(var(--xStart, 0vw), -10dvh, 0) rotate(0deg); }
    25%  { transform: translate3d(calc(var(--xStart, 0vw) + var(--amp, 15px)), 25dvh, 0) rotate(90deg); }
    50%  { transform: translate3d(calc(var(--xStart, 0vw) - var(--amp, 15px)), 50dvh, 0) rotate(180deg); }
    75%  { transform: translate3d(calc(var(--xStart, 0vw) + var(--amp, 15px)), 75dvh, 0) rotate(270deg); }
    100% { transform: translate3d(calc(var(--xStart, 0vw) + var(--drift, 0px)), 110dvh, 0) rotate(360deg); }
  }

  @media (prefers-reduced-motion: reduce) {
    .snowflakes-layer, .snowflake { animation: none !important; display: none !important; }
  }
</style>

<!-- Snow layers for winter -->
<div class="snow layer-1" aria-hidden="true"></div>
<div class="snow layer-2" aria-hidden="true"></div>
<div class="snow layer-3" aria-hidden="true"></div>

<!-- Falling snowflakes layer for winter -->
<div class="snowflakes-layer" aria-hidden="true"></div>

<script>
  // Realistic snow effect for winter
  function makeItSnow() {
    const snowLayers = [
      { element: document.querySelector('.snow.layer-1'), count: 80, sizeRange: [3, 6], speedRange: [15, 25], swayRange: [5, 12] },
      { element: document.querySelector('.snow.layer-2'), count: 60, sizeRange: [2, 4], speedRange: [20, 35], swayRange: [8, 15] },
      { element: document.querySelector('.snow.layer-3'), count: 40, sizeRange: [1, 3], speedRange: [25, 45], swayRange: [10, 18] }
    ];

    const isMobile = window.innerWidth <= 768;

    snowLayers.forEach(layer => {
      if (!layer.element) return;
      layer.element.innerHTML = '';

      const flakeCount = isMobile ? Math.floor(layer.count * 0.5) : layer.count;
      let flakes = "";

      for (let i = 0; i < flakeCount; i++) {
        const leftPos = Math.random() * 100;
        const size = Math.random() * (layer.sizeRange[1] - layer.sizeRange[0]) + layer.sizeRange[0];
        const duration = Math.random() * (layer.speedRange[1] - layer.speedRange[0]) + layer.speedRange[0];
        const delay = Math.random() * 10;
        const drift = (Math.random() - 0.5) * 30; // Reduced from 100 to 30
        const swayAmount = Math.random() * (layer.swayRange[1] - layer.swayRange[0]) + layer.swayRange[0];
        const swayDuration = Math.random() * 2 + 2;
        const swayDelay = Math.random() * 2;

        flakes += `<div class="snowflake-drop" style="left: ${leftPos}%; animation-delay: ${delay}s; animation-duration: ${duration}s; --drift: ${drift}px;">
          <div class="snowflake-particle" style="--size: ${size}px; --sway-amount: ${swayAmount}px; --sway-duration: ${swayDuration}s; --sway-delay: ${swayDelay}s;"></div>
        </div>`;
      }

      layer.element.innerHTML = flakes;
    });
  }

  function checkSnow() {
    const html = document.documentElement;
    if (html.classList.contains("weather-snow")) {
      makeItSnow();
    } else {
      const snowElements = document.querySelectorAll('.snow');
      snowElements.forEach(snow => snow.innerHTML = '');
    }
  }

  // Watch for season changes
  const snowObs = new MutationObserver(checkSnow);
  snowObs.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
  checkSnow(); // Initial check

  // Falling snowflakes for winter
  (function () {
    const EMOJIS = ["❄️","❅","❆"];
    let layer = null;
    let intervalId = null;

    function rand(min, max) { return Math.random() * (max - min) + min; }
    function pick(arr) { return arr[(Math.random() * arr.length) | 0]; }

    function makeSnowflake() {
      if (!layer) return;
      const MAX_ONSCREEN = 12;
      if (layer.childElementCount > MAX_ONSCREEN) return;

      const el = document.createElement("span");
      el.className = "snowflake";
      el.textContent = pick(EMOJIS);

      const size = rand(16, 32);
      const xStart = rand(0, 100);
      const amp = rand(8, 25);
      const drift = rand(-60, 100);
      const fall = rand(12, 20);
      const delay = rand(0, 5);
      const opacity = rand(0.5, 0.9);

      el.style.setProperty("--size", `${size}px`);
      el.style.setProperty("--xStart", `${xStart}vw`);
      el.style.setProperty("--amp", `${amp}px`);
      el.style.setProperty("--drift", `${drift}px`);
      el.style.setProperty("--fall", `${fall}s`);
      el.style.setProperty("--delay", `${delay}s`);
      el.style.setProperty("--opacity", opacity.toFixed(2));
      el.style.left = `calc(${xStart}vw - ${size/2}px)`;

      el.addEventListener("animationend", () => el.remove(), { once: true });
      layer.appendChild(el);
    }

    function startSnowflakes() {
      layer = document.querySelector(".snowflakes-layer");
      if (!layer) return;
      if (intervalId) return;
      intervalId = setInterval(() => {
        if (Math.random() < 0.6) makeSnowflake();
      }, 800);
    }

    function stopSnowflakes() {
      if (intervalId) clearInterval(intervalId);
      intervalId = null;
      if (layer) layer.innerHTML = "";
    }

    function checkSnowflakes() {
      const html = document.documentElement;
      if (html.classList.contains("weather-snow")) {
        startSnowflakes();
      } else {
        stopSnowflakes();
      }
    }

    // Watch for season changes
    const obs = new MutationObserver(checkSnowflakes);
    obs.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
    checkSnowflakes(); // Initial check

    window.startSnowflakes = startSnowflakes;
    window.stopSnowflakes = stopSnowflakes;
  })();
</script>