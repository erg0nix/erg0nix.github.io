<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>{{ if .IsPage }}{{ .Title }} | {{ end }}{{ .Site.Title }}</title>
  {{ with .Site.Params.description }}<meta name="description" content="{{ . }}">{{ end }}
  
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/main.css">
  
  <!-- Seasonal Weather Effects -->
  {{ partial "weather/winter.html" . }}
  {{ partial "weather/autumn.html" . }}
  {{ partial "weather/summer.html" . }}
  {{ partial "weather/spring.html" . }}
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Determine current season based on date
      function getCurrentSeason() {
        const now = new Date();
        const month = now.getMonth() + 1; // getMonth() returns 0-11
        
        // Northern hemisphere seasons (adjust if needed)
        if (month >= 12 || month <= 2) {
          return 'winter'; // Dec, Jan, Feb
        } else if (month >= 3 && month <= 5) {
          return 'spring'; // Mar, Apr, May
        } else if (month >= 6 && month <= 8) {
          return 'summer'; // Jun, Jul, Aug
        } else {
          return 'autumn'; // Sep, Oct, Nov
        }
      }
      
      // Apply weather class based on season
      function applySeasonalWeather() {
        const season = getCurrentSeason();
        const html = document.documentElement;
        
        // Remove any existing weather classes
        html.classList.remove('weather-snow', 'weather-rain', 'weather-summer', 'weather-spring');
        
        // Apply the appropriate weather class
        switch(season) {
          case 'winter':
            html.classList.add('weather-snow');
            break;
          case 'spring':
            html.classList.add('weather-spring');
            break;
          case 'summer':
            html.classList.add('weather-summer');
            break;
          case 'autumn':
            html.classList.add('weather-rain');
            break;
          default:
            html.classList.add('weather-rain'); // fallback to rain
        }
        
      }
      
      // Apply seasonal weather on page load
      applySeasonalWeather();
      
      // All weather effects are now CSS-only
      
      // Optional: Allow manual override via localStorage
      const manualSeason = localStorage.getItem('manualSeason');
      if (manualSeason && ['winter', 'spring', 'summer', 'autumn'].includes(manualSeason)) {
        const html = document.documentElement;
        html.classList.remove('weather-snow', 'weather-rain', 'weather-summer', 'weather-spring');
        html.classList.add(`weather-${manualSeason === 'autumn' ? 'rain' : manualSeason === 'winter' ? 'snow' : manualSeason}`);
        
      }
    });
    

    // Debug function to manually set season (can be called from browser console)
    window.setSeason = function(season) {
      if (['winter', 'spring', 'summer', 'autumn'].includes(season)) {
        localStorage.setItem('manualSeason', season);
        
        // Apply new season
        const html = document.documentElement;
        html.classList.remove('weather-snow', 'weather-rain', 'weather-summer', 'weather-spring');
        html.classList.add(`weather-${season === 'autumn' ? 'rain' : season === 'winter' ? 'snow' : season}`);
        
      } else {
        console.log('Valid seasons: winter, spring, summer, autumn');
      }
    };
    
    // Debug function to clear manual override
    window.clearSeasonOverride = function() {
      localStorage.removeItem('manualSeason');
      location.reload();
    };
  </script>

  <!-- Mobile File Tree Toggle -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const filetree = document.querySelector('.nvim-filetree');
      const hamburger = document.querySelector('.mobile-menu-toggle');

      // Only add mobile menu functionality on smaller screens
      if (window.innerWidth <= 768 && filetree && hamburger) {
        // Create overlay
        const overlay = document.createElement('div');
        overlay.className = 'filetree-overlay';
        document.body.appendChild(overlay);

        // Toggle on hamburger click
        hamburger.addEventListener('click', function() {
          filetree.classList.toggle('open');
          overlay.classList.toggle('active');
        });

        // Close on overlay click
        overlay.addEventListener('click', function() {
          filetree.classList.remove('open');
          overlay.classList.remove('active');
        });
      }

      // Generate line numbers
      const gutter = document.querySelector('.nvim-gutter');
      const content = document.querySelector('.nvim-content');

      if (gutter && content) {
        function updateLineNumbers() {
          const contentHeight = content.scrollHeight;
          const lineHeight = parseFloat(getComputedStyle(content).lineHeight);
          const numLines = Math.ceil(contentHeight / lineHeight);

          gutter.innerHTML = '';
          for (let i = 1; i <= numLines; i++) {
            const lineNum = document.createElement('div');
            lineNum.className = 'line-num';
            lineNum.textContent = i;
            gutter.appendChild(lineNum);
          }
        }

        updateLineNumbers();

        // Update on window resize
        window.addEventListener('resize', updateLineNumbers);
      }
    });
  </script>
</head>
